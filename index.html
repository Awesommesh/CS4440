<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
    <title>CS4440 ImageNET Image Search Project</title>
    <link rel= "stylesheet" type= "text/css" href= "./search.css">
</head>
<body>
<!-- <h1>CS4440 ImageNET Image Search Project</h1> -->
<!-- <label for="myfile">Select a file:</label>
<input type="file" id="myfile" name="myfile"> -->
</body>
<!-- <form action="upload.php" method="post" enctype="multipart/form-data">
    Select image to upload:
    <input type="file" name="fileToUpload" id="fileToUpload">
    <input type="submit" value="Upload Image" name="submit">
</form> -->
<form class="search-wrapper cf" method="POST" id="textform">
    <input type="text" placeholder="Search here..." required="" name="query_input" id="query_input">
    <button type="submit" id="searchButton">Search</button><hr>
</form>
<div id="gallery">  
</div>
<script>
    var imagenetApiEndpoint = "http://imagenet-nlb-b4fcd380459e9b61.elb.us-east-2.amazonaws.com";
    var wnids = []
    var returnedImage = '';
    $("#textform").on("submit", function(e) { 
        e.preventDefault(); 
        $.ajax({
            url: imagenetApiEndpoint + '/stemming?query_input=' + $('input[name="query_input"]').val(),
            type: 'GET',
            success: function(data) {
                console.log($('input[name="query_input"]').val());
                returnedImage = '';
                returnedImage = '<div>';
                wnids = data.split("\n");
                wnidToImage()
            }
            
        })
    });

    var imageUrlRoot = 'https://imagenetbucket.s3.us-east-2.amazonaws.com/images/';
    function wnidToImage() {
        if (wnids.length) {
            $.ajax({
                url: imagenetApiEndpoint + '/imagenet?filter=wnid&value=' + wnids[0],
                type: 'GET',
                success: function(data) {
                    // console.log(wnids[0]);
                    console.log(data.images);
                    $.each(data.images, function(index, image) {       
                        returnedImage += '<img id= "gallery" src="' + image.link + '" />';               
                    })
                    returnedImage += '</div>';
                    wnids.shift();
                    wnidToImage(); 
                }
            })
            $('#gallery').html(returnedImage)
        }
    };

</script>
</html>